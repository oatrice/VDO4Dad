name: CI/CD Pipeline

on:
  push:
    branches:
      - 'main'
      - 'master'
      - 'feature/**'  # Any branch that starts with 'feature/'
  pull_request:
    branches: [ main, master ]

jobs:
  unit-test:
    name: Unit Tests
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18.x'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run unit tests
      run: npm test
  
  e2e-test:
    name: E2E Tests
    needs: unit-test  # Run after unit tests pass
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18.x'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
      
    - name: Install Playwright Browsers
      run: npx playwright install --with-deps
      
    - name: Run Playwright tests
      run: npm run test:e2e
      
  deploy:
    name: Deploy
    needs: [unit-test, e2e-test]  # Wait for both test jobs to complete
    # Only run on main/master branch
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18.x'
    
    - name: Install dependencies
      run: npm ci --production
      
    # Add deployment steps here based on your hosting platform
    # For example, for Vercel, Netlify, or GitHub Pages
    - name: Deploy to production
      run: echo "Add your deployment steps here"
      # Example for GitHub Pages:
      # run: |
      #   npm run build
      #   cd build
      #   touch .nojekyll
      #   git init
      #   git config user.name "GitHub Actions"
      #   git config user.email "actions@github.com"
      #   git add .
      #   git commit -m "Deploy to GitHub Pages"
      #   git push --force --quiet "https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git" main:gh-pages
